<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X vs O Betting - Multiplayer</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .rules {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .wallet-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .wallet-amount {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .timer-section {
            background: linear-gradient(135deg, #2c3e50, #4a235a);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .timer-phase {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #f39c12;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #f1c40f);
            transition: width 1s linear;
        }
        
        .login-section {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .game-status {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        .teams-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .team {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .team-x {
            border: 2px solid #3498db;
        }
        
        .team-o {
            border: 2px solid #e74c3c;
        }
        
        .team-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .total-amount {
            font-size: 1.8rem;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .bets-count {
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .bet-form {
            margin-top: 15px;
        }
        
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        input {
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        button {
            background-color: #2ecc71;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }
        
        button:hover:not(:disabled) {
            background-color: #27ae60;
        }
        
        .withdraw-btn {
            background-color: #e74c3c;
        }
        
        .withdraw-btn:hover:not(:disabled) {
            background-color: #c0392b;
        }
        
        .recent-bets {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .recent-bets h2 {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .bet-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .bet-item:last-child {
            border-bottom: none;
        }
        
        .bet-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .won {
            background-color: #2ecc71;
        }
        
        .lost {
            background-color: #e74c3c;
        }
        
        .pending {
            background-color: #f39c12;
        }
        
        .winner-section {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .winner-amount {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: #2ecc71;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .game-controls button {
            flex: 1;
            max-width: 200px;
        }
        
        .reset-btn {
            background-color: #e74c3c;
        }
        
        .reset-btn:hover {
            background-color: #c0392b;
        }
        
        .online-users {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .online-users h3 {
            margin-bottom: 10px;
            text-align: center;
        }
        
        .user-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .user-badge {
            background-color: #3498db;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .admin-badge {
            background-color: #e74c3c;
        }
        
        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        @media (max-width: 600px) {
            .teams-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .timer-display {
                font-size: 2rem;
            }
            
            .wallet-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>X vs O Betting - Multiplayer</h1>
            <div class="rules">
                <p><strong>Qoidalar:</strong> Pastroq summa to'plagan g'olib - G'oliblar 2X pul yutadi - Teng bo'lsa Admin yutadi</p>
                <p><strong>Vaqt:</strong> 3 daqiqa betting + 30 soniya tanaffus</p>
                <p><strong>Wallet:</strong> Har bir o'yinchi 10,000 UZS bilan boshlanadi - Minimum 15,000 UZS yechish mumkin</p>
            </div>
            
            <div id="walletSection" class="wallet-section" style="display: none;">
                <h3>Mening Walletim</h3>
                <div class="wallet-amount" id="walletAmount">10,000 UZS</div>
                <div class="wallet-info">
                    <div>Balance: <span id="balanceAmount">10,000</span> UZS</div>
                    <button class="withdraw-btn" onclick="withdrawFunds()" id="withdrawButton">Pul yechish (15,000 UZS)</button>
                </div>
            </div>
            
            <div class="timer-section">
                <div class="timer-phase" id="timerPhase">Betting davomiyligi</div>
                <div class="timer-display" id="timerDisplay">03:00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 100%"></div>
                </div>
                <div id="nextRoundInfo" style="display: none;">Keyingi raund: <span id="nextRoundTime">00:30</span> dan keyin</div>
            </div>
            
            <div id="loginSection" class="login-section">
                <h3>O'yinchi nomingizni kiriting</h3>
                <input type="text" id="playerName" placeholder="Ismingiz" value="Player">
                <button onclick="login()">O'yinga kirish</button>
            </div>
            <div class="game-status" id="gameStatus">O'yin davom etmoqda</div>
        </header>
        
        <div id="gameContent" style="display: none;">
            <div class="teams-container">
                <div class="team team-x">
                    <h2 class="team-title">Team X</h2>
                    <div class="total-amount" id="teamXTotal">0 UZS</div>
                    <div class="bets-count" id="teamXBets">0 bets</div>
                    <div class="bet-form">
                        <input type="number" id="xBetAmount" placeholder="Bet miqdori (UZS)" min="100" value="1000">
                        <button id="betXButton" onclick="placeBet('X')">Team X ga bet qo'yish</button>
                    </div>
                </div>
                
                <div class="team team-o">
                    <h2 class="team-title">Team O</h2>
                    <div class="total-amount" id="teamOTotal">0 UZS</div>
                    <div class="bets-count" id="teamOBets">0 bets</div>
                    <div class="bet-form">
                        <input type="number" id="oBetAmount" placeholder="Bet miqdori (UZS)" min="100" value="1000">
                        <button id="betOButton" onclick="placeBet('O')">Team O ga bet qo'yish</button>
                    </div>
                </div>
            </div>
            
            <div class="recent-bets">
                <h2>Oxirgi betlar</h2>
                <div id="recentBetsList">
                    <!-- Betlar ro'yxati -->
                </div>
            </div>
            
            <div class="online-users">
                <h3>Onlayn o'yinchilar</h3>
                <div class="user-list" id="userList">
                    <!-- O'yinchilar ro'yxati -->
                </div>
            </div>
            
            <div class="winner-section" id="winnerSection" style="display: none;">
                <h2>G'olib</h2>
                <div id="winnerName"></div>
                <div class="winner-amount" id="winnerAmount"></div>
            </div>
            
            <div class="game-controls">
                <button id="manualEndButton" onclick="manualEndGame()" style="display: none;">O'yinni tugatish</button>
                <button class="reset-btn" onclick="resetGame()">Yangi o'yin</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase konfiguratsiyasi - BU YERNI O'ZGARTIRING!
        const firebaseConfig = {
            apiKey: "AIzaSyCoID8t0x9jCq2kK8w6Y6Y2Z2a2Y2a2Y2a2Y2a",
            authDomain: "x-vs-o-betting.firebaseapp.com",
            databaseURL: "https://x-vs-o-betting-default-rtdb.firebaseio.com",
            projectId: "x-vs-o-betting",
            storageBucket: "x-vs-o-betting.appspot.com",
            messagingSenderId: "123456789000",
            appId: "1:123456789000:web:aaaaaaaaaaaaaaaaaaaaaa"
        };

        // Firebase ni ishga tushirish
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.log("Firebase allaqachon ishga tushirilgan");
        }

        // O'yin o'zgaruvchilari
        const database = firebase.database();
        const BETTING_TIME = 300; // 10 soniya (test uchun)
        const BREAK_TIME = 30;    // 5 soniya (test uchun)

        let currentPlayer = "";
        let playerId = "";
        let isAdmin = false;
        let myWallet = 100000;
        let serverTimeInterval = null;
        let currentTimer = {
            currentTime: BETTING_TIME,
            isBettingPhase: true,
            isRunning: false
        };

        // O'yinchi nomini kiritish
        function login() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Iltimos, ismingizni kiriting!');
                return;
            }
            
            currentPlayer = playerName;
            playerId = generateId();
            isAdmin = playerName.toLowerCase() === 'admin';
            
            console.log("Kirish:", currentPlayer, "Admin:", isAdmin);
            
            // Firebase ga o'yinchi qo'shish
            database.ref('players/' + playerId).set({
                name: playerName,
                online: true,
                isAdmin: isAdmin,
                wallet: 10000,
                lastActive: Date.now()
            });
            
            // UI ni yangilash
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
            document.getElementById('walletSection').style.display = 'block';
            if (isAdmin) {
                document.getElementById('manualEndButton').style.display = 'block';
                // Admin kirganda darhol timer ni ishga tushirish
                startTimer();
            }
            
            // O'yin ma'lumotlarini yuklash
            loadGameData();
            
            // Timer ni tekshirish
            checkTimer();
        }

        // ID yaratish
        function generateId() {
            return 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Timer ni tekshirish
        function checkTimer() {
            database.ref('timer').on('value', (snapshot) => {
                const timerData = snapshot.val();
                if (timerData) {
                    currentTimer = timerData;
                    updateTimerDisplay(timerData);
                    console.log("Timer yangilandi:", timerData);
                } else {
                    console.log("Timer ma'lumotlari yo'q");
                    // Agar timer yo'q bo'lsa, betting phase da deb hisoblaymiz
                    updateTimerDisplay({
                        currentTime: BETTING_TIME,
                        isBettingPhase: true,
                        isRunning: false
                    });
                }
            });
        }

        // Timer ni boshlash
        function startTimer() {
            console.log("Timer ishga tushirildi - Admin:", currentPlayer);
            
            const initialTimer = {
                currentTime: BETTING_TIME,
                isBettingPhase: true,
                isRunning: true,
                lastUpdated: Date.now(),
                startedBy: currentPlayer
            };
            
            database.ref('timer').set(initialTimer);
            
            // Server timerini yangilash
            if (serverTimeInterval) {
                clearInterval(serverTimeInterval);
            }
            
            serverTimeInterval = setInterval(() => {
                updateServerTimer();
            }, 1000);
        }

        // Server timerini yangilash
        function updateServerTimer() {
            if (!isAdmin) return;
            
            database.ref('timer').once('value').then((snapshot) => {
                const timerData = snapshot.val();
                if (timerData && timerData.isRunning) {
                    let newTime = timerData.currentTime - 1;
                    let newPhase = timerData.isBettingPhase;
                    
                    console.log("Server timer:", newTime, "seconds left");
                    
                    if (newTime <= 0) {
                        if (timerData.isBettingPhase) {
                            console.log("Betting vaqti tugadi");
                            endGame();
                            newTime = BREAK_TIME;
                            newPhase = false;
                        } else {
                            console.log("Tanaffus tugadi, yangi raund");
                            resetGame();
                            newTime = BETTING_TIME;
                            newPhase = true;
                        }
                    }
                    
                    // Yangi vaqtni saqlash
                    database.ref('timer').update({
                        currentTime: newTime,
                        isBettingPhase: newPhase,
                        lastUpdated: Date.now()
                    });
                }
            }).catch(error => {
                console.log("Timer yangilashda xato:", error);
            });
        }

        // Timer displeyni yangilash
        function updateTimerDisplay(timerData) {
            const minutes = Math.floor(timerData.currentTime / 60);
            const seconds = timerData.currentTime % 60;
            const timerDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timerDisplay').textContent = timerDisplay;
            document.getElementById('timerPhase').textContent = timerData.isBettingPhase ? 
                'Betting davomiyligi' : 'Tanaffus';
            
            // Progress bar
            const totalTime = timerData.isBettingPhase ? BETTING_TIME : BREAK_TIME;
            const progressPercent = (timerData.currentTime / totalTime) * 100;
            document.getElementById('progressFill').style.width = `${progressPercent}%`;
            
            // Bet tugmalarini faollashtirish/faolsizlashtirish
            const canBet = timerData.isBettingPhase && timerData.isRunning;
            const betButtons = [document.getElementById('betXButton'), document.getElementById('betOButton')];
            betButtons.forEach(button => {
                button.disabled = !canBet;
                if (!canBet) {
                    button.title = "Betting vaqti emas!";
                } else {
                    button.title = "Bet qo'yish";
                }
            });
            
            console.log("Bet qo'yish mumkin:", canBet);
        }

        // O'yin ma'lumotlarini yuklash
        function loadGameData() {
            // O'zimning wallet ma'lumotlarim
            database.ref('players/' + playerId + '/wallet').on('value', (snapshot) => {
                const walletAmount = snapshot.val() || 10000;
                myWallet = walletAmount;
                document.getElementById('walletAmount').textContent = formatCurrency(walletAmount) + ' UZS';
                document.getElementById('balanceAmount').textContent = formatCurrency(walletAmount);
                
                // Withdraw tugmasini faollashtirish/faolsizlashtirish
                document.getElementById('withdrawButton').disabled = walletAmount < 15000;
            });

            // Team X ma'lumotlari
            database.ref('teamX').on('value', (snapshot) => {
                const data = snapshot.val() || { total: 0, bets: 0 };
                document.getElementById('teamXTotal').textContent = formatCurrency(data.total) + ' UZS';
                document.getElementById('teamXBets').textContent = data.bets + ' bets';
            });

            // Team O ma'lumotlari
            database.ref('teamO').on('value', (snapshot) => {
                const data = snapshot.val() || { total: 0, bets: 0 };
                document.getElementById('teamOTotal').textContent = formatCurrency(data.total) + ' UZS';
                document.getElementById('teamOBets').textContent = data.bets + ' bets';
            });

            // Betlar ro'yxati
            database.ref('bets').limitToLast(10).on('value', (snapshot) => {
                const betsList = document.getElementById('recentBetsList');
                betsList.innerHTML = '';
                
                const bets = snapshot.val() || {};
                // Eng yangi betlarni birinchi ko'rsatish
                Object.keys(bets).reverse().forEach(betId => {
                    const bet = bets[betId];
                    const betItem = document.createElement('div');
                    betItem.className = 'bet-item';
                    
                    const statusClass = bet.status === 'Won' ? 'won' : 
                                      bet.status === 'Lost' ? 'lost' : 'pending';
                    
                    betItem.innerHTML = `
                        <div>
                            <strong>${bet.player}</strong><br>
                            ${formatCurrency(bet.amount)} UZS
                        </div>
                        <div>
                            <span class="bet-status ${statusClass}">${bet.status}</span><br>
                            Team ${bet.team}
                        </div>
                    `;
                    
                    betsList.appendChild(betItem);
                });
            });

            // Onlayn o'yinchilar
            database.ref('players').on('value', (snapshot) => {
                const userList = document.getElementById('userList');
                userList.innerHTML = '';
                
                const players = snapshot.val() || {};
                Object.values(players).forEach(player => {
                    if (player.online) {
                        const userBadge = document.createElement('div');
                        userBadge.className = player.isAdmin ? 'user-badge admin-badge' : 'user-badge';
                        userBadge.textContent = player.name + (player.isAdmin ? ' ðŸ‘‘' : '') + ' (' + formatCurrency(player.wallet || 10000) + ' UZS)';
                        userList.appendChild(userBadge);
                    }
                });
            });

            // O'yin holati
            database.ref('gameState').on('value', (snapshot) => {
                const gameState = snapshot.val() || { ended: false, winner: null };
                
                if (gameState.ended) {
                    document.getElementById('gameStatus').textContent = 'O\'yin tugadi';
                    document.getElementById('gameStatus').style.backgroundColor = 'rgba(231, 76, 60, 0.3)';
                    
                    if (gameState.winner) {
                        document.getElementById('winnerSection').style.display = 'block';
                        document.getElementById('winnerName').textContent = gameState.winner === 'Owner' ? 'Admin' : 'Team ' + gameState.winner;
                        document.getElementById('winnerAmount').textContent = 'Yutdi: ' + formatCurrency(gameState.winAmount) + ' UZS';
                    }
                } else {
                    document.getElementById('gameStatus').textContent = 'O\'yin davom etmoqda';
                    document.getElementById('gameStatus').style.backgroundColor = 'rgba(46, 204, 113, 0.3)';
                    document.getElementById('winnerSection').style.display = 'none';
                }
            });
        }

        // Bet qo'yish
        function placeBet(team) {
            console.log("Bet qo'yish urinilyapti:", team);
            
            // Timer ma'lumotlarini tekshirish
            if (!currentTimer.isBettingPhase || !currentTimer.isRunning) {
                alert('Betting vaqti tugadi! Keyingi raundni kuting.');
                return;
            }
            
            const amountField = team === 'X' ? document.getElementById('xBetAmount') : document.getElementById('oBetAmount');
            const amount = parseInt(amountField.value);
            
            if (isNaN(amount) || amount < 100) {
                alert('Iltimos, to\'g\'ri miqdor kiriting (minimum 100 UZS)!');
                return;
            }
            
            if (amount > myWallet) {
                alert('Sizda yetarli mablag\' yo\'q! Sizda: ' + myWallet + ' UZS');
                return;
            }
            
            console.log("Bet qo'yilmoqda:", amount, "UZS, Team:", team);
            
            // Wallet dan pulni ayiramiz
            const newWalletAmount = myWallet - amount;
            database.ref('players/' + playerId + '/wallet').set(newWalletAmount);
            
            // Firebase ga bet qo'shish
            const betId = 'bet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            database.ref('bets/' + betId).set({
                player: currentPlayer,
                amount: amount,
                team: team,
                status: 'Pending',
                timestamp: Date.now(),
                playerId: playerId
            }).then(() => {
                console.log("Bet muvaffaqiyatli qo'shildi");
                
                // Team summasini yangilash
                const teamRef = team === 'X' ? 'teamX' : 'teamO';
                database.ref(teamRef).transaction(current => {
                    if (current) {
                        return {
                            total: (current.total || 0) + amount,
                            bets: (current.bets || 0) + 1
                        };
                    } else {
                        return {
                            total: amount,
                            bets: 1
                        };
                    }
                });
                
                amountField.value = '1000';
                alert('Bet muvaffaqiyatli qo\'yildi: ' + amount + ' UZS Team ' + team);
                
            }).catch(error => {
                console.log("Bet qo'shishda xato:", error);
                alert('Bet qo\'yishda xato: ' + error.message);
            });
        }

        // O'yinni tugatish
        function endGame() {
            database.ref('teamX').once('value').then((teamXSnapshot) => {
                database.ref('teamO').once('value').then((teamOSnapshot) => {
                    const teamX = teamXSnapshot.val() || { total: 0 };
                    const teamO = teamOSnapshot.val() || { total: 0 };
                    
                    let winner, winAmount;
                    
                    if (teamX.total < teamO.total) {
                        winner = 'X';
                        winAmount = teamX.total * 2;
                    } else if (teamO.total < teamX.total) {
                        winner = 'O';
                        winAmount = teamO.total * 2;
                    } else {
                        winner = 'Owner';
                        winAmount = teamX.total + teamO.total;
                    }
                    
                    // G'olibni saqlash
                    database.ref('gameState').set({
                        ended: true,
                        winner: winner,
                        winAmount: winAmount
                    });
                    
                    // Betlarni yangilash va g'oliblarga to'lov
                    database.ref('bets').once('value').then((betsSnapshot) => {
                        const bets = betsSnapshot.val() || {};
                        Object.keys(bets).forEach(betId => {
                            const bet = bets[betId];
                            let status = 'Lost';
                            
                            if (winner === 'Owner') {
                                status = 'Lost';
                            } else if (bet.team === winner) {
                                status = 'Won';
                                // G'olibga to'lov
                                const winAmount = bet.amount * 2;
                                database.ref('players/' + bet.playerId + '/wallet').transaction(current => {
                                    return (current || 10000) + winAmount;
                                });
                            }
                            
                            database.ref('bets/' + betId + '/status').set(status);
                        });
                    });
                });
            });
        }

        // Qo'lda o'yinni tugatish
        function manualEndGame() {
            if (!isAdmin) {
                alert('Faqat admin o\'yinni tugata oladi!');
                return;
            }
            endGame();
        }

        // Yangi o'yin
        function resetGame() {
            database.ref('teamX').set({
                total: 0,
                bets: 0
            });
            
            database.ref('teamO').set({
                total: 0,
                bets: 0
            });
            
            database.ref('bets').remove();
            
            database.ref('gameState').set({
                ended: false,
                winner: null,
                winAmount: 0
            });
        }

        // Pul yechish
        function withdrawFunds() {
            if (myWallet < 15000) {
                alert('Minimum 15,000 UZS yechish mumkin!');
                return;
            }
            
            if (confirm('15,000 UZS yechib olishni tasdiqlaysizmi?')) {
                const newAmount = myWallet - 15000;
                database.ref('players/' + playerId + '/wallet').set(newAmount);
                alert('15,000 UZS muvaffaqiyatli yechib olindi!');
            }
        }

        // Pul formati
        function formatCurrency(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // O'yinchi chiqayotganda
        window.addEventListener('beforeunload', () => {
            if (playerId) {
                database.ref('players/' + playerId).update({
                    online: false,
                    lastActive: Date.now()
                });
            }
            
            if (serverTimeInterval) {
                clearInterval(serverTimeInterval);
            }
        });

        // Debug ma'lumotlari
        function showDebugInfo() {
            console.log("=== DEBUG INFO ===");
            console.log("Player:", currentPlayer);
            console.log("Player ID:", playerId);
            console.log("Admin:", isAdmin);
            console.log("Wallet:", myWallet);
            console.log("Timer:", currentTimer);
            console.log("Betting phase:", currentTimer.isBettingPhase);
            console.log("Timer running:", currentTimer.isRunning);
            console.log("==================");
        }

        // Har 5 soniyada debug ma'lumotlarini ko'rsatish
        setInterval(showDebugInfo, 5000);

        // Dastlabki sozlamalar
        window.addEventListener('load', () => {
            console.log("X vs O Betting Game yuklandi");
        });
    </script>
</body>
</html>
